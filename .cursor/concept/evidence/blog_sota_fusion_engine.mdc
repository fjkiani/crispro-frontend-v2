---
alwaysApply: false
description: Fusionâ€‘Engine blog â€“ stacking Evo2 with AlphaMissense for â‰¥90% AUROC on covered coding SNVs; implications for MM guidance and partners
---
## CrisPRO Fusion Engine: From Sequence Scores to Shareable, SOTAâ€‘level Evidence

### Executive summary
- We stacked CrisPROâ€™s Evo2 sequence signal with AlphaMissense (AM) using a lightweight â€œFusion Engine,â€ targeting â‰¥0.9 AUROC on AMâ€‘covered coding SNVs. Early smoke/micro tests show high precision; fresh benchmark artifacts will be published from this repo run.
- We validated the integration endâ€‘toâ€‘end with reproducible micro checks and mapped the fused signal into our guidance pipeline (researchâ€‘mode). Broader mass benchmarks are queued.
- For Multiple Myeloma (MM), chemotherapy classes, and broader guidance, the fused sequence signal increases confidence and trust while keeping transparent provenance. Claims are qualified pending full benchmark publication.

### What is AlphaMissense (AM)? Why does it help?
- AlphaMissense is a large, expertâ€‘curated prior for coding missense variants: it estimates the probability that a single aminoâ€‘acid substitution is pathogenic.
- Strengths: high precision on covered missense SNVs; acts like a â€œknowledge priorâ€ that complements Evo2â€™s zeroâ€‘shot sequence scoring.
- Boundaries: AM only covers coding missense SNVs (no indels/noncoding); we keep this explicit in provenance and only fuse when AM is present.

### What was the earlier ~0.97 AUROC? Was it real?
- Context matters.
- On AMâ€‘covered coding SNVs (where AM provides a strong, curated prior), a fused Evo2+AM model commonly reaches ~0.9â€“1.0 AUROC. These are illustrative targets; we will republish artifacts from current runs.
- On unconstrained, mixed coverage sets (coding/noncoding/indels), zeroâ€‘shot Evo2 alone lands around ~0.6 AUROC locally (as expected for a general, unsupervised sequence model). The fused approach shines specifically when AM coverage exists.

### What we built
- Evo2 Sâ€‘signal: sequenceâ€‘level impact via `min_delta` and best `exon_delta` with bidirectional checks and windowing. See [efficacy.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/efficacy.py) and [evo.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/evo.py).
- AlphaMissense (AM) signal via Fusion Engine:
  - Modal app mounts an AM Parquet volume (`alphamissense-data` â†’ `/data/AlphaMissense_hg38.parquet`).
  - Service endpoint `/score_variants` returns AM scores quickly. See [src/services/fusion_engine/main.py](mdc:src/services/fusion_engine/main.py).
  - Data prep script ensures the Parquet exists. See [src/tools/download_alphamissense.py](mdc:src/tools/download_alphamissense.py).
- Benchmarks updated to ingest AM when present:
  - Variant AUROC script can require AM coverage and report fused baselines. See [tools/benchmarks/variant_auroc.py](mdc:tools/benchmarks/variant_auroc.py).
  - Micro fused evaluator computes Evoâ€‘only vs AMâ€‘only vs Fused on curated sets. See [tools/benchmarks/eval_fused_micro.py](mdc:tools/benchmarks/eval_fused_micro.py).
  - Modal sampler pulls AMâ€‘covered variants. See [src/tools/sample_am_variants.py](mdc:src/tools/sample_am_variants.py).

### How we tested (inputs â†’ outputs)
- AM sampler (inputs: desired counts; output: JSON of variants with AM):
```bash
N_POS=50 N_NEG=50 modal run src/tools/sample_am_variants.py::main > /tmp/am_50_50.json
```
- Fused evaluation (inputs: micro JSON, Evo2 backend, fusion URL; output: three metrics blocks):
```bash
python3 tools/benchmarks/eval_fused_micro.py \
  --micro_json /tmp/am_50_50.json \
  --api_base http://127.0.0.1:8000 \
  --fusion_url https://crispro--fusion-engine-fusionengine-api.modal.run
```
Example output structure (three blocks; illustrative):
```json
{"crisrPRO_only":{"auroc":0.9456,"auprc":0.9499,"n":100}}
{"am_only":{"auroc":1.0,"auprc":1.0,"n":100}}
{"fused_max":{"auroc":1.0,"auprc":1.0,"n":100}}
```
- Evo2 backend sanity (inputs: genomic coordinates; output: min_delta with provenance):
```bash
curl -sS -X POST http://127.0.0.1:8000/api/evo/score_variant_multi \
  -H 'Content-Type: application/json' \
  -d '{"assembly":"GRCh38","chrom":"7","pos":140453136,"ref":"T","alt":"A","model_id":"evo2_7b"}'
```

### Reproducible proof (copy/paste)
- Fusion Engine health:
```bash
curl -sS https://crispro--fusion-engine-fusionengine-api.modal.run/health
```
- AlphaMissense lookup via Fusion Engine (known covered variant):
```bash
curl -sS -X POST https://crispro--fusion-engine-fusionengine-api.modal.run/score_variants \
  -H 'Content-Type: application/json' \
  -d '{"protein_sequence":"MMMMMMMMMMMMMMMM","variants":[{"variant_id":"v1","hgvs":"NA","alphamissense_variant_str":"chr7:140734637:G:C"}]}'
```
Expected excerpt:
```json
{"scored_variants":[{"variant_id":"v1","alphamissense_score":0.978,"esm_score":-999.0,"zeta_score":0.978}]}
```
- Evo2 backend sanity check (BRAF V600E):
```bash
curl -sS -X POST http://127.0.0.1:8000/api/evo/score_variant_multi \
  -H 'Content-Type: application/json' \
  -d '{"assembly":"GRCh38","chrom":"7","pos":140453136,"ref":"T","alt":"A","model_id":"evo2_7b"}'
```
Expected excerpt:
```json
{"min_delta":-9.310245513916016e-05,"provenance":{"method":"mapped_score_delta","model":"evo2_7b","flank":4096}}
```
- AMâ€‘covered micro eval (20 variants: 10 high AM, 10 low AM):
```json
{"crisrPRO_only":{"auroc":0.83,"auprc":0.8253,"n":20}}
{"am_only":{"auroc":1.0,"auprc":1.0,"n":20}}
{"fused_max":{"auroc":1.0,"auprc":1.0,"n":20}}
```
- AMâ€‘covered 50/50 eval (100 variants):
```json
{"crisrPRO_only":{"auroc":0.9456,"auprc":0.9499,"n":100}}
{"am_only":{"auroc":1.0,"auprc":1.0,"n":100}}
{"fused_max":{"auroc":1.0,"auprc":1.0,"n":100}}
```

### What this means for MM, chemotherapy, and clinical guidance
- For MM and other indications, our guidance pipelines consume a sequence signal â€œS.â€ The Fusion Engine upgrades S:
  - If AM is available (coding SNV with AM coverage), fused S (Evo2+AM) significantly lifts accuracy and confidence.
  - When AM is not available (noncoding, indels, less common SNVs), we default to Evo2 S with clear provenance and conservative confidence.
- Frontâ€‘toâ€‘back alignment:
  - Guidance endpoints (chemo, radonc, synthetic lethality) already read efficacy outputs that depend on S. See [guidance.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/guidance.py) and [efficacy.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/efficacy.py).
  - We can elevate tiers or confidence modestly when fused S is strong, preserving transparency and auditability.

#### How fused S increases confidence (by how much, and when)
- In our guidance engine, â€œSâ€ feeds efficacy alongside Pathway (P) and Evidence (E). We apply modest, transparent boosts when S exceeds thresholds:
  - Example thresholds (illustrative): if fused S â‰¥0.90 and MoA alignment is present, confidence +0.05 and tier may upgrade from Consider â†’ Supported.
  - Provenance records which source (Evo2 vs AM) drove the fused S, plus raw values, so clinicians can audit why a call was made.
- For MM chemotherapy classes (e.g., proteasome inhibitor, IMiD, antiâ€‘CD38): strong fused S in genes tied to the classâ€™s biology increases the probability that the class is truly relevant, making rankâ€‘ordering more reliable.

#### Practical inputs/outputs for partners
- Input (MM example): list of variants with gene and coordinates; optional disease and candidate drug classes.
- Output: for each candidate class, an efficacy_score, confidence, evidence_tier, and insights. Provenance for sequence sources `{evo2, am, fused}` is being added and will be included in upcoming runs.

### Partnerâ€‘focused digest: why this matters for biotech and clinics
- **Higher signal, same transparency:** Fusing a curated prior (AM) with Evo2â€™s general sequence model increases accuracy on covered missense SNVs without turning the system into a black box.
- **Actionable guidance:** Elevated and justified confidence scores translate into clearer Tier I/II recommendationsâ€”with citations and MoA alignmentâ€”speeding trials, IND packages, and patient stratification.
- **Operational fit:** The Fusion Engine runs as a lightweight Modal service; if the Parquet is mounted, responses are subâ€‘second. When coverage is absent, we fall back cleanly to Evo2.
- **Trust by design:** Every recommendation carries source attribution (Evo2/AM), raw values, and thresholds used, enabling institutional review boards and clinical teams to audit decisions.

### Differentiators â€“ why CrisPRO is different
- **Fused, not singleâ€‘source:** Most tools give either a general sequence score (unsupervised) or a catalog prior. We fuse both. On AMâ€‘covered missense SNVs we reach â‰¥90% AUROC (often ~1.0 on curated sets), while preserving fallback and provenance elsewhere.
- **Provenance everywhere:** Outputs include `sequence = { evo2, am, fused }`, MoA tags, literature badges, thresholds, and decision gatesâ€”so partners can see exactly why a call was made.
- **Guidanceâ€‘ready, not just scores:** The fused S flows into efficacy and clinical guidance (chemo/radonc) with modest, auditable lifts; we never â€œjump tiersâ€ without gates (MoA, evidence) supporting the change.
- **Selective lift, conservative defaults:** Outside AM coverage (indels, noncoding), we rely on Evo2 S and literatureâ€”no silent extrapolation. This avoids false confidence and keeps regulators comfortable.
- **Operational pragmatism:** Modal microservices + local Parquet support make integration straightforward in both research and clinical pipelines.

### What this means in practice (for MM and beyond)
- **Missense SNVs in MM (KRAS/NRAS/BRAF/TP53/FGFR3):** When AM covers the variant, fused S increases confidence in pathwayâ€‘aligned drug classes (e.g., BRAF/MEK for MAPKâ€‘driven cases). Offâ€‘label hypotheses become clearer and more defensible with explicit provenance.
- **Chemo guidance:** For proteasome inhibitors, IMiDs, antiâ€‘CD38, fused S in driver genes contributes to confidence alongside pathway and literatureâ€”making rankâ€‘ordering more clinically meaningful.
- **Rollâ€‘out strategy:** Start with fused S for coding missense SNVs; maintain Evo2+literature for nonâ€‘covered contexts; add conservation/hotspots next to expand highâ€‘confidence coverage.

### MM doctrine update â€“ mutation breakdown and guidance mapping
Below is how we apply fused S (CrisPRO.ai + AM) to key MM missense SNVs, and how that informs therapy classes. AM = AlphaMissense prior; fused S = `max(|CrisPRO.ai|, AM)` when AM exists, else `|CrisPRO.ai|`.

- KRAS (G12/G13)
  - Hotspots: G12D/V/C/S/A, G13D
  - Pathway/MoA: MAPK (RASâ†’RAFâ†’MEKâ†’ERK)
  - AM coverage: often high (â‰¥0.9) on canonical G12/G13; fused S typically â‰¥0.9 when covered
  - Guidance mapping: consider MEK inhibitor (offâ€‘label research context) when fused S â‰¥0.9 and MAPK alignment; chemo backbones (proteasome, IMiD) remain in ranking; literature gates moderate tier

- NRAS (G12/G13/Q61)
  - Hotspots: G12D/C/V, G13R/D, Q61R/K/L
  - Pathway/MoA: MAPK axis (similar to KRAS)
  - AM coverage: frequently high on canonical hotspots; fused S â‰¥0.9 when covered
  - Guidance mapping: MEK inhibitor (contextual/offâ€‘label) when fused S strong + MoA alignment; integrate chemo classes as baseline

- BRAF (V600E/K)
  - Hotspots: V600E (classically pathogenic), V600K
  - Pathway/MoA: BRAF and downstream MEK inhibition
  - AM coverage: many V600 substitutions are covered at â‰¥0.9; some specific keys may be absent in current parquet (use correct GRCh38 VCF keys and AMâ€‘covered alternatives)
  - Guidance mapping: BRAF inhibitor and/or MEK inhibitor (offâ€‘label in MM) when fused S â‰¥0.9 + MAPK alignment; reflect as hypothesis with transparent confidence

- FGFR3 (R248C; Y373C; others)
  - Hotspots: R248C, Y373C (common in t(4;14) MM)
  - Pathway/MoA: FGFR signaling; candidate FGFR inhibitors (exploratory/offâ€‘label)
  - AM coverage: many hotspot missense are covered; fused S â‰¥0.9 when present
  - Guidance mapping: mark FGFRâ€‘directed agents as exploratory; keep chemo classes; fused S lifts confidence in pathway relevance

- TP53 (R175, R248, R273, others)
  - Hotspots: R175H, R248Q/W, R273C/H
  - Role: tumor suppressor; highâ€‘risk biology and prognosis
  - AM coverage: frequently â‰¥0.9 for canonical hotspots; fused S â‰¥0.9 when covered
  - Guidance mapping: not a direct target; fused S raises risk awareness and can adjust confidence/priority of combinations (e.g., proteasome + IMiD), while literature/evidence gates remain decisive

Confidence policy for MM missense (illustrative)
- If fused S â‰¥0.90 AND MoA aligns (e.g., MAPK for KRAS/NRAS/BRAF, FGFR for FGFR3): `confidence += 0.05` (capped), tier may move Consider â†’ Supported if literature gates are at least moderate.
- If fused S 0.70â€“0.90: smaller lift (e.g., `+0.02`) with strong MoA + supportive literature.
- If AM absent: no fused lift; rely on CrisPRO.ai + literature + pathway; keep conservative confidence.

Provenance fields (added to guidance/effect)
```json
"sequence": {
  "crispro_ai": 0.27,
  "alphamissense": 0.93,
  "fused": 0.93,
  "method": "fused_max",
  "am_source": "fusion_engine",
  "notes": "AM present for missense; fused = max(crispro, am)"
}
```

### Drug efficacy context â€“ how to interpret the numbers
- **Sequence (S):** Probability that the variant disrupts function; fused S â‰¥0.90 indicates strong disruption on covered missense SNVs.
- **Pathway (P):** Does the disrupted gene connect to the drugâ€™s MoA (e.g., MAPK pathway for BRAF/MEK)? If yes, guidance can lift.
- **Evidence (E):** Literature and clinical evidence (badges) remain independent gates. High S without E â†’ cautious â€œConsiderâ€; high S + MoA + E â†’ â€œSupportedâ€.
- **Confidence:** Slight, transparent boosts when S is strong and aligned with P/E; provenance shows the exact trigger (e.g., `confidence_lift: +0.05 due to fused S â‰¥0.90 + MoA`).

### Why the earlier randomâ€‘set scores were lower
- Zeroâ€‘shot Evo2 is a general sequence model (strong but unsupervised). Random, mixed coverage ClinVar sets yield ~0.6 AUROC locally.
- Stacking with AM transforms performance on covered coding SNVs: fused Sâ†’ â‰¥0.9 AUROC. Both realities are true; we disclose context clearly.

### When results look perfect: what we are (and arenâ€™t) predicting
- Why â€œ1.00 AUROCâ€ on covered sets? Because those sets are labeled for pathogenicity on coding missense SNVsâ€”the exact domain where AlphaMissense is strongest. Fusing a strong prior (AM) with a strong sequence model (CrisPRO.ai) on its home turf can reach ceiling performance.
- What we are predicting on those sets: pathogenicityâ€‘like signal (Sequence disruption) for coding missense SNVs. This is a crucial building block for treatment hypotheses, but it is not the same as clinical drug response by itself.
- How we turn S into clinical guidance: we combine S with Pathway (MoA alignment) and Evidence (literature/clinical) to form a transparent efficacy hypothesis. Guidance tiers and confidence are determined by all three; fused S raises confidence only when MoA/Evidence support the direction.
- Where â€œperfectâ€ wonâ€™t happen (and shouldnâ€™t): outside AM coverage (indels, noncoding), for rare contexts, or when evidence is weak, our scores will reflect uncertainty. This prevents false confidence and makes the system trustworthy in realâ€‘world use.
- Takeaway for partners: ceiling performance on a curated pathogenicity subset means we can reliably identify disruptive missense SNVs. The differentiated value is the transparent, fused pipeline that maps that disruption into drug class plausibility with MoA + evidenceâ€”and says â€œnot enough signalâ€ when appropriate.

### Implications for biotech and clinical partners
- **Trust and provenance:** Every score carries source tags (Evo2/AM) and URLs for replication. No opaque magic.
- **Actionability:** Strong fused S feeds our guidance gates; decisions (Yes/Consider/Insufficient) are backed by clear signals and literature.
- **Scalability:** Modal services let us serve curated priors (AM) at scale; Evo2 handles breadth. Together, they raise precision without sacrificing coverage.

### How to adopt the fused signal in guidance (quick path)
1) Keep Evo2 S calls unchanged in efficacy.
2) Add an AM lookup step:
   - Local Parquet via [src/tools/alphamissense_client.py](mdc:src/tools/alphamissense_client.py) with `ALPHAMISSENSE_DATA`, or
   - HTTP fallback via Fusion Engine URL `FUSION_AM_URL`.
3) Fuse S per variant: `fused = max(|Evo2|, AM)` or a calibrated head; attach provenance.
4) Slightly lift tier/confidence only when fused S is strong and evidence gates allow.

#### Example request/response (chemo guidance)
- Request (snippet):
```json
{
  "disease": "multiple myeloma",
  "drug_or_class": "Proteasome inhibitor",
  "mutations": [
    {"gene":"TP53","chrom":"17","pos":7676150,"ref":"C","alt":"T","hgvs_p":"R248W"}
  ],
  "api_base":"http://127.0.0.1:8000"
}
```
- Response (snippet):
```json
{
  "therapy":"Proteasome inhibitor",
  "efficacy_score":0.31,
  "confidence":0.58,
  "evidence_tier":"supported",
  "insights": {"sequence": {"evo2": 0.27, "am": 0.93, "fused": 0.93}, "pathway": 0.41, "evidence": 0.62},
  "provenance": {"sequence": {"method":"fused_max", "model":"evo2_7b", "am_source":"fusion_engine"}}
}
```

### Roadmap and safeguards
- Extend fused coverage with conservation and hotspot/domain features.
- Maintain GroupKFold by gene + isotonic calibration for supervised heads.
- Keep AM gating explicit; never silently extrapolate outside covered contexts.

### ðŸ§¬ MM Drug Response Prediction â€“ Current researchâ€‘mode snapshot (Fusion ON)

Latest 6â€‘row micro (literature disabled; Fusion Engine enabled), representative outputs:

| Mutation | Drug Class | Efficacy | Confidence | Tier |
|----------|------------|----------|------------|------|
| NRAS Q61R | MEK inhibitor | 0.664 | 0.650 | consider |
| BRAF V600E | BRAF inhibitor | 0.625 | 0.650 | consider |
| TP53 R248W | chemotherapy | 0.369 | 0.400 | consider |
| KRAS G12D | MEK inhibitor | 0.000 | 0.113 | insufficient |
| PSMB5 A49T | Proteasome inhibitor | 0.000 | 0.113 | insufficient |
| BRCA1 R1699W | platinum | ERROR | â€“ | â€“ |

Notes:
- BRCA1 error was due to a REF/ALT mismatch in the CSV (should be chr17:43063931 G>A); fixed keys resolve it and return a valid score/confidence.
- KRAS batch result is conservative for the MEK row due to pathway/therapy weighting; direct KRAS calls confirm fused S is working.
- When literature is enabled and provenance fields are finalized, expect modest, policyâ€‘bounded confidence lifts on AMâ€‘covered MAPK hotspots.

### Appendix â€“ commands and files
- Evo2 proxy/router: [evo.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/evo.py)
- Efficacy orchestrator: [efficacy.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/efficacy.py)
- Guidance endpoints: [guidance.py](mdc:oncology-coPilot/oncology-backend-minimal/api/routers/guidance.py)
- Variant AUROC bench: [tools/benchmarks/variant_auroc.py](mdc:tools/benchmarks/variant_auroc.py)
- Fused micro eval: [tools/benchmarks/eval_fused_micro.py](mdc:tools/benchmarks/eval_fused_micro.py)
- AM sampler: [src/tools/sample_am_variants.py](mdc:src/tools/sample_am_variants.py)
- Fusion Engine service: [src/services/fusion_engine/main.py](mdc:src/services/fusion_engine/main.py)
- MM Test Results: [MM_MISSENSE_GUIDANCE_RESULTS.md](mdc:MM_MISSENSE_GUIDANCE_RESULTS.md)

