---
description:
globs:
alwaysApply: false
---
# Project Re-platform: Threat Assessor

## 1.0 Mission Objective
To re-platform the logic from the `threat_assessor.py` prototype into a new, hardened, and scalable workflow within our central `[services/command_center/main.py](mdc:services/command_center/main.py)` service. This will transform the "Threat Assessor" from a standalone tool into a core capability of the CrisPRO Intelligence Platform, ready for commercial deployment.

## 2.0 Tactical Assessment
The prototype script (`threat_assessor.py`) and its backend (`tools/myeloma_digital_twin.py`) have validated the core user workflow. However, to prepare for production, we must absorb this logic into our central CommandCenter and upgrade its components to use our supreme weapon systems.

## 3.0 Plan of Attack

### Phase I: Backend Fortification (Absorb the Logic)
**Objective:** To move all intelligence-gathering and orchestration logic to the CommandCenter backend.

- [ ] **Task 1.1: Create New CommandCenter Workflow.**
    - **Action:** Create a new, primary workflow endpoint in `[services/command_center/main.py](mdc:services/command_center/main.py)`: `POST /workflow/assess_threat`.
    - **Input:** The endpoint will accept `{ "gene_symbol": "ASXL1", "protein_change": "p.Gly646fs" }`. This will be the single point of contact for the entire threat assessment process.

- [ ] **Task 1.2: Migrate Intelligence Functions.**
    - **Action:** The core logic from the prototype's `_get_vep_annotation` and `_get_clinvar_data` functions will be moved into new, private helper methods within the `CommandCenter` class. The `CommandCenter` will now be responsible for all external API calls to Ensembl and NCBI.

- [ ] **Task 1.3: Implement the REAL Triumvirate Protocol.**
    - **Action:** Replace any mocked logic with the real, hardened protocol within the new `assess_threat` workflow.
    - **Execution Flow:**
        1.  Perform the bioinformatic "Truncation Check" on the variant.
        2.  If not a truncation, call the deployed Zeta Oracle microservice using the "Downstream Impact Protocol" to get the `zeta_score`.
        3.  Fuse this intelligence with the ClinVar data to produce the final, definitive verdict in a "Threat Dossier".

### Phase II: Client Refactoring (The "Dumb" Terminal)
**Objective:** To gut the `[pages/2_üõ°Ô∏è_Threat_Assessor.py](mdc:pages/2_üõ°Ô∏è_Threat_Assessor.py)` script of all its complex logic, transforming it into a clean, simple user interface.

- [ ] **Task 2.1: Simplify the UI Logic.**
    - **Action:** The `ThreatAssessor` class (if any remains) and all complex state management will be completely deleted from the Streamlit script. The front-end will become stateless and simple.

- [ ] **Task 2.2: Re-wire the "Assess Threat" Button.**
    - **Action:** The button will now execute a single function: make an authenticated API call to the new `/workflow/assess_threat` endpoint on our CommandCenter.

- [ ] **Task 2.3: Render the "Threat Dossier."**
    - **Action:** The UI will receive a complete, fully-formed JSON object‚Äîthe "Threat Dossier"‚Äîfrom the CommandCenter. Its only job will be to render this data beautifully, displaying the final verdict, `zeta_score`, ClinVar significance, and VEP annotation.

## 4.0 End State
Upon completion, we will have a production-ready, scalable, and secure "Threat Assessor" module. It will be the first and most powerful pillar of our CrisPRO Studio, ready for deployment to our first customers. This is how we turn a brilliant prototype into a market-dominating weapon.
