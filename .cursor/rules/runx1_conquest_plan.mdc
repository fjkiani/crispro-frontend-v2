# ðŸš€ Operation RUNX1 Conquest: The Flagship Campaign ðŸš€

## STATUS: 90% COMPLETE - FINAL VISUALIZATION PHASE

## 1.0 Mission Alignment & Objective

This document outlines the detailed implementation strategy for the next critical phase of the **"FLAGSHIP DEMO CAMPAIGN: RUNX1-FPD PRECISION MEDICINE PLATFORM"**. 

Our primary objective is to replace the mock data and placeholder functions within the Patient Digital Twin with a live, state-of-the-art, Evo2-powered guide design and analysis workflow. This plan directly addresses the remaining tasks outlined in our project scratchpad, specifically `Task 1.4 (UI Integration)` and `Task 2.3 (Advanced Visualization)`.

This is not a new initiative. It is the logical and necessary evolution of our existing work, moving from prototype to a fully-functional, AI-driven clinical tool.

## 2.0 Phased Implementation

### âœ… Phase I: Strategic Arsenal Evolution (COMPLETE)
**Objective:** To carefully phase out superseded tools while preserving stability.

- **Task 1.1: Archive `tools/intelligent_guide_finder.py`**. 
  - **Status: COMPLETE.** Tool was already deprecated and removed from the arsenal.

### âœ… Phase II: Forge the RUNX1 Arsenal (COMPLETE - DEBUGGING)
**Objective:** To build the core, AI-powered guide design workflow within the `CommandCenter`.

- **Task 2.1: Implement the `/v3/workflow/execute_guide_design_campaign` Endpoint**
  - **Status: COMPLETE, PENDING VALIDATION.** The `command_center` V3 service has been implemented. However, end-to-end integration testing has revealed a critical failure in the Kill Chain's `VALIDATE` phase. The `command_center_client` cannot communicate with the `blast-service` due to an `asyncio` conflict. A patch has been developed and is pending deployment and re-testing.
  - **Action:** We will implement this new endpoint in `services/command_center/
  main.py`. This is the core of the new system, orchestrating the entire guide 
  design process. It adapts the logic from our `guide_design_module.mdc` 
  technical plan.
  - **Input:** `{ "battle_plan_id": int }`
  - **Workflow Logic:**
    1.  Load the `BattlePlanModel` for the specific RUNX1-FPD patient.
    2.  Call the `evo-service` (`ZetaForge`) to generate guide RNA candidates 
    for the target locus (e.g., `RUNX1`).
    3.  Perform parallel validation for efficacy (`ZetaOracle`), safety 
    (`BlastService`), and immunogenicity.
    4.  Calculate the "Assassin Score" for each guide.
    5.  Persist the results back into the `BattlePlanModel` in the database.
    6.  Update the battle plan's status to `interventions_designed`.

### âœ… Phase III: Integrate with the Patient Digital Twin (COMPLETE - PENDING BACKEND FIX)
**Objective:** To connect the new backend workflow to the frontline user interface.

- **Task 3.1: Refactor `pages/1_ðŸ§¬_Patient_Digital_Twin.py`**
  - **Status: COMPLETE, PENDING BACKEND FIX.** The "Design Precision Intervention" button is correctly wired to the `/v3` workflow. The UI is operationally ready but is blocked by the backend `blast-service` integration failure. Full functionality awaits the successful patch and redeployment of the `command_center`.
  *Action:** The "Design Precision Intervention" button will be rewired.
  - **New UI Logic:**
    1. On click, the UI will first call the existing endpoint to create a 
    `BattlePlan` for the patient.
    2. It will then immediately call our new `/v3/workflow/
    execute_guide_design_campaign` endpoint, passing the new `battle_plan_id`.
    3. The UI will then poll for the updated `BattlePlanModel` and display the 
    ranked list of guide candidates once the status is `interventions_designed`

### âž¡ï¸ Phase IV: Advanced Genomic Visualization (NEXT OBJECTIVE)
**Objective:** To provide powerful, intuitive visualizations for the newly designed guides.

- **Task 4.1: Build the Interactive RUNX1 Genomic Browser**
  - **Action:** In the Patient Digital Twin UI, we will create a new component using a library like `streamlit-locus-plot`.
  - **Features:**
    - Display the `RUNX1` gene structure (exons/introns).
    - Highlight the locations of the patient's specific mutations.
    - Plot the positions of the top-ranked guide RNAs generated by our workflow.
    - Show functional domains on the gene.

## 3.0 Technical Blueprints & Scoring
The core technical specifications for the microservices (`ZetaForge`, `ZetaOracle`, `BlastService`) and the "Assassin Score" formula as detailed in `.cursor/rules/guide_design_module.mdc` remain the foundational blueprints for this implementation. We will build our clients and workflows according to those specifications.

----
# Doctrine v4.0: The Metastasis Interception Arsenal

## 1.0 Mission Briefing
The old guard designs weapons against a primary tumor. We will design weapons against the invasion itself. This doctrine outlines the operational protocol for our `CommandCenter` to translate a high-level strategic objective (e.g., "Prevent Angiogenesis") into a validated, AI-forged therapeutic blueprint, all while being tracked in our stateful `BattlePlan` system.

## 2.0 The Two-Layered Kill Chain

Our system is composed of two primary workflows operating in a strategic hierarchy:

1.  **The Strategic Layer (The "Why"):** A future, high-level campaign that validates the correct gene to target for a given mission.
2.  **The Tactical Layer (The "How"):** Our core guide design workflow that forges the actual CRISPR weapons for a validated target.

Our immediate mission is to build the **Tactical Layer** and then upgrade our system to include the **Strategic Layer**.

## 3.0 IMMEDIATE MISSION: Build the Tactical Layer

### Phase I: Purge the Heresy (Cleansing the Arsenal)
- **Task 1.1: Delete `tools/intelligent_guide_finder.py`**.
- **Task 1.2: Delete the `tools/chopchop/` Directory**.
- **Task 1.3: Delete `tools/chopchop_integration.py`**.

### Phase II: Forge the v3 Campaign Workflow (The Core of the Tactical Layer)
- **Task 2.1: Create New Endpoint: `/v3/workflow/execute_guide_design_campaign`**
  - **Input:** `{ "battle_plan_id": int }`
- **Task 2.2: Implement the "Battle Plan Kill Chain"**
  - **Logic:** Load BattlePlan -> Fetch Sequence -> Forge Candidates (Live Evo2) -> Parallel Validation (Oracle, BLAST, Immunity) -> Calculate Assassin Score -> Persist Dossier to BattlePlan.
- **Task 2.3: Upgrade the `BattlePlanModel`**
    - Ensure `proposed_interventions` field can store the rich `GuideDossier` JSON.

### Phase III: Refactor the Frontline UIs
- Refactor `Intelligent_Guide_Designer.py` and `Patient_Digital_Twin.py` to use the new `/v3` workflow.

## 4.0 FUTURE MISSION: Build the Strategic Layer (TO-DO)

- **Task 4.1: Create New Endpoint: `/v4/workflow/plan_metastasis_interception_campaign`**
    - **Input:** `{ "battle_plan_id": int, "mission_objective": "Disrupt Angiogenesis" }`

- **Task 4.2: Implement the "Metastasis Interception" Kill Chain**
    - **Phase I: Target Validation (The "Why")**
        1.  Load the `BattlePlan`.
        2.  Consult internal knowledge base for the biological pathway related to the `mission_objective` (e.g., VEGF pathway for Angiogenesis).
        3.  Use our future discriminative endpoints (`/predict_gene_essentiality`, `/predict_variant_impact`) to score every gene in that pathway for that specific patient.
        4.  Achieve "Target Lock" on the most vulnerable gene and persist this validated target to the `BattlePlan`.
    - **Phase II: Weapon Forging (The "How")**
        1.  Make an internal, automated call to our `/v3/workflow/execute_guide_design_campaign` endpoint, passing the `battle_plan_id`.
        2.  Receive the result and confirm the `BattlePlan` is updated with a full "Warfighting Dossier."

- **Task 4.3: Document the New Endpoints from the Metastasis Doctrines**
    - **Action:** Create a new `services/README.md` that documents all the future planned endpoints from the intervention/interception doctrines, such as `/predict_gene_essentiality`, `/generate_therapeutic_protein_coding_sequence`, etc.

---
*The v2.0 technical blueprints for the individual services and the "Assassin Score" formula remain the core components for both the Tactical and future Strategic layers.*


description:
globs:
alwaysApply: false
---
 