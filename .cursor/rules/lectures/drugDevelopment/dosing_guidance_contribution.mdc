# Dosing Guidance Contribution
## Pharmacogenomics-Based Personalized Dosing

**Status:** âœ… IMPLEMENTED (Jan 2025)  
**Integration:** Therapy Fit â†’ Toxicity Risk â†’ Dosing Guidance  
**Evidence Level:** CPIC Level A/B recommendations

---

## ğŸ¯ What This MOAT Does

Provides **personalized drug dosing recommendations** based on:
1. **Pharmacogenomics** - Metabolizer phenotype from germline variants
2. **Toxicity Risk** - Pharmacogene-MoA pathway overlap
3. **Cumulative Toxicity** - Prior therapy exposure (anthracyclines, platinum, taxanes)
4. **Treatment History** - Cross-resistance and sequencing context

---

## ğŸ”¬ Core Components

### 1. Pharmacogene Coverage (Oncology-Focused)

| Gene | Drug Examples | Clinical Impact |
|------|---------------|-----------------|
| **DPYD** | 5-FU, Capecitabine | Fatal toxicity in poor metabolizers |
| **UGT1A1** | Irinotecan | Severe neutropenia in *28/*28 |
| **TPMT** | 6-MP, Azathioprine | Myelosuppression risk |
| **CYP2D6** | Tamoxifen, Ondansetron | Reduced efficacy/increased toxicity |
| **CYP2C19** | Cyclophosphamide | Altered activation |

### 2. Dose Adjustment Logic

```python
# From api/services/dosing_guidance_service.py
def compute_adjusted_dose(standard_dose, phenotype, drug):
    """
    CPIC-aligned dose adjustments:
    - Poor Metabolizer (DPYD *2A/*2A): 0% of standard (CONTRAINDICATED)
    - Intermediate Metabolizer: 50% of standard
    - Normal Metabolizer: 100% of standard
    - Rapid/Ultrarapid: May need higher doses
    """
```

### 3. Cumulative Toxicity Tracking

| Drug Class | Cumulative Risk | Threshold |
|------------|-----------------|-----------|
| **Anthracyclines** | Cardiotoxicity | >450 mg/mÂ² doxorubicin-equivalent |
| **Platinum agents** | Nephrotoxicity, Ototoxicity | Cumulative platinum exposure |
| **Taxanes** | Neuropathy | Grade â‰¥2 prior neuropathy |

---

## ğŸ“¡ API Endpoints

### Primary Endpoint
```
POST /api/dosing/guidance
```

### Request Schema
```json
{
  "patient_id": "JD-001",
  "drug_name": "5-fluorouracil",
  "germline_variants": [
    {"gene": "DPYD", "hgvs": "c.1905+1G>A", "zygosity": "heterozygous"}
  ],
  "treatment_history": [
    {"drug": "epirubicin", "dose": "100 mg/mÂ²", "cycles": 4}
  ]
}
```

### Response Schema
```json
{
  "patient_id": "K-001",
  "drug_name": "5-fluorouracil",
  "recommendations": [
    {
      "gene": "DPYD",
      "phenotype": "Intermediate Metabolizer",
      "cpic_level": "A",
      "standard_dose": "400 mg/mÂ²",
      "recommended_dose": "200 mg/mÂ²",
      "adjustment_factor": 0.5,
      "adjustment_type": "REDUCE",
      "rationale": "DPYD Intermediate Metabolizer - reduce dose by 50%",
      "monitoring": ["Weekly CBC", "DPD activity monitoring"],
      "alternatives": ["Capecitabine (with same reduction)"]
    }
  ],
  "cumulative_toxicity_alert": {
    "anthracycline_exposure": true,
    "platinum_exposure": false,
    "taxane_exposure": false,
    "recommendation": "Monitor for cardiotoxicity - prior anthracycline exposure"
  }
}
```

---

## ğŸ”— Integration Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THERAPY FIT (S/P/E)                          â”‚
â”‚  "This drug might work for your mutation profile"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOXICITY RISK                                 â”‚
â”‚  "Watch out for these pharmacogene risks"                       â”‚
â”‚  â€¢ Pharmacogene detection (DPYD, UGT1A1, TPMT)                 â”‚
â”‚  â€¢ MoA-pathway overlap scoring                                  â”‚
â”‚  â€¢ Risk level: HIGH/MODERATE/LOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOSING GUIDANCE (NEW)                         â”‚
â”‚  "Give this much, monitor this way"                             â”‚
â”‚  â€¢ Metabolizer phenotype â†’ dose adjustment                      â”‚
â”‚  â€¢ Cumulative toxicity alerts                                   â”‚
â”‚  â€¢ CPIC evidence levels                                         â”‚
â”‚  â€¢ Alternative drug suggestions                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Validation Results (Jan 2025)

### Unit Tests
| Test | Status | Description |
|------|--------|-------------|
| DPYD *2A/*2A â†’ 5-FU | âœ… PASS | Contraindicated (0% dose) |
| DPYD *1/*2A â†’ 5-FU | âœ… PASS | 50% dose reduction |
| UGT1A1 *28/*28 â†’ Irinotecan | âœ… PASS | 30% dose reduction |
| TPMT *3A/*3A â†’ 6-MP | âœ… PASS | Contraindicated |
| Cumulative anthracycline alert | âœ… PASS | Cardiotoxicity warning |

### Integration Tests
| Test | Status | Description |
|------|--------|-------------|
| Full pipeline (variants â†’ dose) | âœ… PASS | End-to-end flow |
| No variants â†’ normal dosing | âœ… PASS | Default handling |
| Multiple pharmacogenes | âœ… PASS | Combined recommendations |

---

## ğŸ“Š Frontend Components

### ToxicityChip
- Location: `oncology-frontend/src/components/vus/ToxicityChip.jsx`
- Displays: Risk level chip with tooltip
- Integrates: Real-time toxicity risk from `/api/safety/toxicity_risk`

### DosingGuidanceCard
- Location: `oncology-frontend/src/components/dosing/DosingGuidanceCard.jsx`
- Displays: 
  - Dose adjustment recommendations
  - CPIC evidence level badges
  - Monitoring requirements
  - Alternative drug suggestions
  - Cumulative toxicity alerts

---

## ğŸ“š Evidence Sources

1. **CPIC Guidelines** - Clinical Pharmacogenetics Implementation Consortium
   - DPYD: PharmGKB PA166104963
   - UGT1A1: PharmGKB PA166104967
   - TPMT: PharmGKB PA166104965

2. **PharmGKB** - Pharmacogenomics Knowledgebase
   - Gene-drug associations
   - Variant annotations
   - Dosing recommendations

3. **FDA Labels** - Drug-specific pharmacogenomics warnings

---

## âš ï¸ Limitations & RUO Disclaimer

**RESEARCH USE ONLY (RUO)**

This system provides in-silico dosing guidance based on:
- Published CPIC guidelines
- PharmGKB annotations
- Computational predictions

**NOT intended for clinical use without:**
- Licensed clinical pharmacist review
- Institutional protocol validation
- Patient-specific clinical judgment

---

## ğŸ”® Future Enhancements

1. **Real-time PharmGKB API** - Live annotation lookup
2. **Drug-drug interactions** - CYP450 inhibitor/inducer tracking
3. **Organ function adjustment** - Renal/hepatic dosing
4. **Population-specific calibration** - Ancestry-aware defaults
5. **Clinical decision support alerts** - EHR integration

---

## ğŸ“ Code Locations

| Component | Path |
|-----------|------|
| Dosing Service | `api/services/dosing_guidance_service.py` |
| Dosing Router | `api/routers/dosing.py` |
| Dosing Schemas | `api/schemas/dosing.py` |
| PharmGKB Router | `api/routers/pharmgkb.py` |
| Safety Service | `api/services/safety_service.py` |
| ToxicityChip | `oncology-frontend/src/components/vus/ToxicityChip.jsx` |
| DosingGuidanceCard | `oncology-frontend/src/components/dosing/DosingGuidanceCard.jsx` |
| Validation Tests | `scripts/validation/test_dosing_guidance.py` |

---

**Last Updated:** January 2025  
**Author:** Zo (Agent)  
**Reviewed By:** Alpha (Commander)
