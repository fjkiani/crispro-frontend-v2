---
alwaysApply: true
description: Forge & Boltz Master Doctrine - Complete consolidation of all structural validation and therapeutic design files
---

# ‚öîÔ∏è FORGE & BOLTZ MASTER DOCTRINE

**Last Updated:** 2025-01-XX  
**Status:** ‚úÖ **CONSOLIDATED SOURCE OF TRUTH**  
**Consolidated From:**
- `doctrine_forge_and_boltz.mdc` - Forge/Boltz integration
- `doctrine_long_range_forge.mdc` - Long-range generation
- `forge_boltz_failure_analysis_doctrine.mdc` - Failure analysis
- `zeta_forge_doctrine.mdc` - Zeta Forge core
- `zeta_forge_reclamation_doctrine.mdc` - Forge reclamation
- `gauntlet_doctrine.mdc` - Gauntlet validation
- `structural_integrity_protocol.mdc` - Structural validation protocol
- `boltz_1d_to_3d_doctrine.mdc` - Boltz 1D‚Üí3D validation

---

## üìö TABLE OF CONTENTS

1. [Executive Summary](#executive-summary)
2. [The Structural Integrity Protocol](#the-structural-integrity-protocol)
3. [The Truth or Treason Protocol](#the-truth-or-treason-protocol)
4. [Boltz Integration Doctrine](#boltz-integration-doctrine)
5. [Forge Service Architecture](#forge-service-architecture)
6. [Gauntlet Appropriation Strategy](#gauntlet-appropriation-strategy)
7. [Failure Analysis & Remediation](#failure-analysis--remediation)
8. [Advanced Therapeutic Design](#advanced-therapeutic-design)
9. [References to Archived Files](#references-to-archived-files)

---

## üéØ EXECUTIVE SUMMARY

### **Mission**
Execute end-to-end `in silico` directed evolution campaigns to forge novel protein inhibitors against high-value targets, with full structural validation and binding affinity prediction.

### **Core Philosophy: The Three-Phase Kill Chain**
1. **Phase I: The Forge** - Generate diverse candidate sequences using Evo2
2. **Phase II: The Sieve** - Fast, cheap filtering via sequence-level validation
3. **Phase III: The Gauntlet** - 3D structural validation as final arbiter

### **The "Wet Noodle" Problem**
A DNA sequence that scores well in 1D (`delta_score`) can still translate into a physically useless protein that fails to fold correctly in 3D (`pLDDT` score). This is why multi-dimensional validation is mandatory.

### **Key Principles**
- **Sequence Likelihood ‚â† Structural Viability**: 1D scoring insufficient alone
- **Mandatory 3D Validation**: pLDDT ‚â• 70 threshold for structural integrity
- **Mission-Dependent Metrics**: Different scoring strategies for inhibitors vs knockouts
- **Language Matters**: Use DNA sequences as prompts, not English

---

## üèóÔ∏è THE STRUCTURAL INTEGRITY PROTOCOL

### **The "Wet Noodle" Problem**
- **Symptom**: Sequences that score well in 1D fail catastrophically in 3D
- **Root Cause**: Sequence likelihood doesn't guarantee proper protein folding
- **Solution**: Multi-dimensional validation system

### **The Three-Phase Kill Chain**

#### **Phase I: The Forge (Generation)**
- **Objective**: Generate diverse candidate protein sequences using Evo2
- **Weapon**: Zeta Forge with Evo2 generative models
- **Output**: Raw protein sequences (nanobodies, inhibitors)
- **Quality Gates**: Sequence-level likelihood scoring, basic biological constraints
- **Command**: Use DNA sequences as prompts (bait_sequence), not English

#### **Phase II: The Sieve (Sequence Validation)**
- **Objective**: Fast, cheap filtering to eliminate biologically "illiterate" candidates
- **Weapon**: Evo2 delta scoring, sequence analysis
- **Metrics**: `delta_likelihood_score`, GC content, length validation
- **Purpose**: Eliminate obvious failures before expensive structural analysis
- **Rule of Engagement**: Candidates with `delta_score` below threshold (e.g., -5.0) discarded

#### **Phase III: The Gauntlet (Structural Validation)**
- **Objective**: 3D structural prediction as the final arbiter of physical viability
- **Weapon**: AlphaFold/ColabFold/Boltz service
- **Metrics**: `pLDDT` score, structural confidence, interface quality
- **Purpose**: Ensure proteins fold correctly and maintain structural integrity
- **Rule of Engagement**: Any candidate with `pLDDT < 70` is a "wet noodle" ‚Üí **DISCARD**

### **Orchestration Requirements**
- **Command Center**: Central service managing complex multi-stage workflows
- **Parallel Processing**: Use `asyncio.gather` for batch validation steps
- **Error Handling**: Graceful degradation when services unavailable
- **Provenance Tracking**: Complete audit trail of all operations

---

## ‚öîÔ∏è THE TRUTH OR TREASON PROTOCOL

### **Core Tenet**
Our platform was not built to design new weapons; it was built to find the truth. We will take any biological claim, subject it to the cold, hard logic of our AI, and deliver a definitive verdict.

### **Three-Phase Assault Plan**

#### **Phase I: Intelligence Gathering (The ZSIS Protocol)**
- **Objective**: Deconstruct vague claims into precise, testable hypotheses
- **Process**:
  1. Identify core biological claim
  2. Isolate specific protein/gene target (e.g., MMP-9)
  3. Isolate specific effector molecule (e.g., Protein "U-995")
  4. Formulate hypothesis: "Molecule X inhibits Target Y to produce Effect Z"
- **Status**: ‚úÖ Complete - ZSIS Protocol implemented in `OPERATION: DEEP DIVE`
- **Primary Asset**: `HypothesisValidator.jsx`

#### **Phase II: The Gauntlet (Define the Kill Shot)**
- **Objective**: Quantitatively prove enemy weapon ineffectiveness
- **Execution**:
  1. **Test Enemy Weapon**: Run effector molecule through Zeta Oracle
  2. **Result**: Pathetically low Zeta Score (e.g., -0.0000622)
  3. **Define Victory**: Run `in silico` knockout of target gene
  4. **Maximum Impact Score**: Catastrophic negative score becomes benchmark
- **Endpoint**: `POST /api/oracle/calculate_zeta_score`

#### **Phase III: The Forge (Demonstrate Superiority)**
- **Objective**: Solve the problem on the spot, forging superior therapeutic weapon
- **Execution**:
  1. **Counter-Command**: CommandCenter issues directive to Zeta Forge
  2. **Unleash Forge**: Iterative generate-and-test loop with Evo2
  3. **Forge Superior Weapon**: Create weapon approaching Maximum Impact Score
  4. **Deliver Receipt**: Final dossier proving superiority

### **The Zeta Translation Engine (Forge-and-Assemble Protocol)**
**STATUS:** OPERATIONAL DIRECTIVE

The initial Truth or Treason Protocol revealed a tactical flaw: The Forge delivered DNA sequences, not fully assembled protein weapons.

#### **Upgraded Phase III Execution:**
1. **Forge**: Zeta Forge generates novel DNA sequence
2. **Assemble**: System invokes Zeta Translation Engine to translate DNA ‚Üí protein
3. **Deliver Biologic Blueprint**: Complete output with both `dna_sequence` and `protein_sequence`

#### **The Biologic Blueprint (Standardized Intelligence Product)**
Minimal viable structure:
- `dna_sequence`: Raw, AI-generated genetic blueprint
- `protein_sequence`: Fully assembled, translated protein weapon
- `zeta_score`: Lethality and impact rating from Zeta Oracle

### **Lessons from Failures**

#### **Failure 1: Wrong Language (The "Sledgehammer" Tactic)**
- **Error**: Using English-language prompts with Evo2
- **Lesson**: Evo2 trained on DNA language, not English
- **Solution**: Use DNA sequences as prompts (bait_sequence)

#### **Failure 2: Wrong Metric (The "Stability" Paradox)**
- **Error**: Selecting most negative Zeta Score for inhibitors
- **Lesson**: Negative score = disruption (good for knockouts, bad for inhibitors)
- **Solution**: For inhibitors, select highest score (stable, favorable interaction)

#### **Failure 3: The "Wet Noodle" Problem**
- **Error**: Sequences that score well in 1D fail in 3D
- **Lesson**: Sequence likelihood ‚â† structural viability
- **Solution**: Mandatory 3D validation (Gauntlet) with pLDDT ‚â• 70 threshold

---

## üî¨ BOLTZ INTEGRATION DOCTRINE

### **Dual-Stage Prediction Architecture**
Boltz-2 operates a sophisticated two-stage pipeline:

1. **Stage 1 (Structure Prediction)**: Generates 3D structure (`.cif`) and confidence metrics (`confidence.json`)
2. **Stage 2 (Affinity Prediction)**: Calculates binding affinity using Stage 1 output as input

### **The "False Flag" Protocol V2**
Our strategy for protein-protein interaction modeling:

#### **YAML Schema Requirements:**
- Root object with `version: 1`
- `sequences` list containing all molecules
- `properties` list defining the affinity task

#### **Strategic Classification:**
- Target protein: declared as `protein` type
- Candidate nanobody: declared as `ligand` type (False Flag)
- Affinity task: points to nanobody `ligand` ID

#### **True Target Metrics:**
- `iptm` score from `confidence.json` (protein-protein interaction confidence)
- `pLDDT` score (per-residue structural confidence)
- `ptm` score (overall fold confidence)

### **MSA Requirements**
- **MSA is Non-Negotiable**: For protein structures, Multiple Sequence Alignment (MSA) is required
- **MSA Server**: The `--use_msa_server` flag outsources MSA generation to ColabFold API
- **Implication**: Without MSA, structure prediction will fail

### **1D‚Üí3D Validation Pipeline**
- **Phase 1**: Sequence Likelihood (Evo2) - Fast filtering
- **Phase 2**: RNA Folding (ViennaRNA) - [Future]
- **Phase 3**: Complex Structure (AlphaFold 3) - Final validation

### **AlphaFold 3 Integration**
- **Why AlphaFold 3 (Not AlphaFold 2)**: Handles RNA-DNA complexes, better accuracy
- **Submission Format**: JSON with sequences, properties, job metadata
- **Quality Metrics**: pLDDT, iPTM, fraction_disordered
- **Acceptance Criteria**: pLDDT ‚â• 70 for structural integrity

---

## üè≠ FORGE SERVICE ARCHITECTURE

### **Service Reclamation Doctrine**

#### **Environmental Purification**
- Remove all legacy dependencies and conflicting packages
- Use clean, stable container images (NVIDIA CUDA base)
- Isolate complex builds into dedicated microservices

#### **API Simplification**
- **Endpoint 1**: `POST /generate_inhibitor` - Submit forging job, returns `job_id`
- **Endpoint 2**: `GET /status/{job_id}` - Poll for job status and final result
- **Async Job Pattern**: Background Modal methods for long-running operations

#### **Logic Purification**
- Remove all hardcoded values and magic numbers
- Implement proper error handling and retry logic
- Add comprehensive logging and provenance tracking

### **Expected Transformation**
- **Before**: Chaotic, unreliable service with multiple failure modes
- **After**: Clean, reliable, battle-tested service with proper orchestration

### **Zeta Forge Core Capabilities**
- **Generation**: Evo2 prompt-guided sequence generation
- **Translation**: DNA ‚Üí protein translation
- **Validation**: Sequence-level and structure-level checks
- **Safety**: Viral content guardrails, length validation

---

## ‚öîÔ∏è GAUNTLET APPROPRIATION STRATEGY

### **ColabFold Intelligence Analysis**

#### **The "Rifle" (AlphaFold2.ipynb/batch.py)**
- Single protein structure prediction
- Fast, reliable for individual structures
- Limited to protein-only predictions

#### **The "Combined-Arms Platform" (Boltz1.ipynb)**
- Protein-protein interaction modeling
- Dual-stage prediction (structure ‚Üí affinity)
- More complex but more powerful

### **Zeta Gauntlet Service**
- **Purpose**: Centralized structural validation service
- **Capabilities**:
  - Single protein structure prediction
  - Protein-protein interaction modeling
  - Binding affinity prediction
- **Integration**: Modal service with proper GPU allocation

### **Quality Metrics**
- **pLDDT**: Per-residue structural confidence (0-100)
- **iPTM**: Interface confidence for protein-protein interactions (0-1)
- **ptm**: Overall fold confidence (0-1)
- **fraction_disordered**: Structural disorder fraction (0-1)

### **Acceptance Criteria**
- **Structural Integrity**: pLDDT ‚â• 70 (mandatory threshold)
- **Binding Confidence**: iPTM > 0.7 for high-confidence interfaces
- **Fold Quality**: ptm > 0.7 for reliable structures

---

## üîç FAILURE ANALYSIS & REMEDIATION

### **Common Failure Signatures**

#### **Metric Mismatch**
- **Symptom**: Selecting wrong metric for mission type
- **Example**: Using negative scores for inhibitors (should be positive)
- **Solution**: Mission-dependent metric selection

#### **Input Hygiene Gaps**
- **Symptom**: Malformed YAML, missing MSA, incorrect coordinate systems
- **Example**: KeyError from parse_yaml function
- **Solution**: Comprehensive input validation and schema enforcement

#### **Diversity & Deduplication Issues**
- **Symptom**: Low diversity in generated candidates
- **Example**: Repetitive sequences, lack of variation
- **Solution**: Diversity management in generation loop

#### **Resource & Reproducibility Problems**
- **Symptom**: GPU allocation failures, non-reproducible results
- **Example**: Out-of-memory errors, random seed issues
- **Solution**: Proper resource scaling, fixed random seeds

### **Non-Breaking Remediation Plan**

#### **1. Orchestration Layer**
- Centralize workflow management in CommandCenter
- Implement proper async/await patterns
- Add comprehensive error handling

#### **2. Gates & Scoring**
- Implement mission-dependent scoring strategies
- Add proper threshold enforcement
- Track all scoring decisions in provenance

#### **3. Diversity Management**
- Implement diversity metrics in generation
- Add deduplication logic
- Track candidate diversity in provenance

#### **4. Reproducibility**
- Fix random seeds for all operations
- Document all parameters in provenance
- Enable full audit trail reconstruction

---

## üöÄ ADVANCED THERAPEUTIC DESIGN

### **The "Forge & Simulate" Protocol**

#### **Four-Phase Iterative Loop**
1. **Generate**: Create candidate sequences with Evo2
2. **Score**: Evaluate with Oracle (sequence-level)
3. **Validate**: Structural validation with Boltz/Gauntlet
4. **Refine**: Use feedback to improve generation

### **Long-Range Generation**
- **Capability**: Generate sequences up to 1M tokens
- **Use Cases**: Complete gene sequences, large regulatory elements
- **Requirements**: Proper context windows, memory allocation

### **Context-Aware Prompting**
- **Rich Biological Context**: Gene sequences, pathways, binding sites
- **Mechanism Specification**: Inhibit vs activate
- **Design Constraints**: GC content, homopolymers, viral content

### **Iterative Optimization**
- **Generate ‚Üí Score ‚Üí Refine Loop**: Continuous improvement
- **Convergence Criteria**: Score threshold or max iterations
- **Feedback Integration**: Use validation results to guide generation

---

## üìñ REFERENCES TO ARCHIVED FILES

All original files have been preserved in `forge_boltz/archive/`:

- **Forge and Boltz**: `archive/doctrine_forge_and_boltz.mdc`
  - Original: Forge/Boltz integration patterns
  
- **Long-Range Forge**: `archive/doctrine_long_range_forge.mdc`
  - Original: Long-range generation capabilities
  
- **Failure Analysis**: `archive/forge_boltz_failure_analysis_doctrine.mdc`
  - Original: Comprehensive failure analysis and remediation
  
- **Zeta Forge**: `archive/zeta_forge_doctrine.mdc`
  - Original: Zeta Forge core capabilities
  
- **Forge Reclamation**: `archive/zeta_forge_reclamation_doctrine.mdc`
  - Original: Service reclamation and purification
  
- **Gauntlet**: `archive/gauntlet_doctrine.mdc`
  - Original: Gauntlet validation strategy
  
- **Structural Integrity**: `archive/structural_integrity_protocol.mdc`
  - Original: Three-phase kill chain protocol
  
- **Boltz 1D‚Üí3D**: `archive/boltz_1d_to_3d_doctrine.mdc`
  - Original: 1D‚Üí3D validation pipeline

---

## ‚öîÔ∏è DOCTRINE STATUS: ACTIVE

**LAST UPDATED:** 2025-01-XX  
**APPLIES TO:** All therapeutic design, structural validation, and protein-protein interaction modeling  
**ENFORCEMENT:** Mandatory across all development and operational activities

**This master doctrine represents the complete consolidation of all Forge & Boltz knowledge. Every protocol, pattern, and lesson learned is preserved and organized for maximum clarity and actionability.**
