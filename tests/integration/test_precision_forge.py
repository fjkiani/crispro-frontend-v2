import modal
import pytest

# A high-quality, long-context bait sequence is critical for the Precision Forge.
# This sequence is a 1200bp segment from the human BRCA1 gene, a region where
# Evo2 is known to have high performance.
BRCA1_BAIT_SEQUENCE = "ATGGATTTATCTGCTCTTCGCGTTGAAGAAGTACAAAATGTCATTAATGCTATGCAGAAAATCTTAGAGTGTCCCATCTGGTAAGTCAGCACAAGAGTGTATTAATTTGGGATTCCTATGATTATCTCCTATGCAAATGAACAGAATTGACCTTACATACTAGGGAAGAAAAGACATGTCTAGTAAGATCAGCAAATACTGGGAGAAGCCATCATTCCAACTTTCACAAATATGTGAAACCCTAGTTTAGAAGATAGATCTTCAGGGGATCAAGGAAAGAAAGAAGTCATAATCATCCAAATATTAAAGGGAGCAACATCAATCAGCCAGAAGGGTTAAGAAGAAAGGAAGAACCCCAGAGCACTGTTAATTACCCACACCCTTCCATTACAGGAAGGGACACGTACATCACTGAATCTTACTACCAGTTCAGGAGTTCACTTCCTAGTTTAAGAAGGTAGACCATCTTTCTATGGTTGTAAAGACAATGATGGAAAAATCAGAACATTAATTACAAACAAGTACTCCTGGAAGATCGCTATGAAGAGAGAGAACCAAATCCAACTCAAGAAGGCAAAGATCTACAGATTCAATACTTCACCAAGAATACCGAAAAGAGATTGCAAATTACCAGAGGACAACCTGAGTCTAACCAGGAGTCAAAGGAGGATGGAAGAAGGAAGAGCAAGGAAAAGGCACATTTTGAAGAGTATTGAATACACACGGTCATCAGCTGACACAAATCCCAATGAAGCACAGAAGAACAAAATGAAACAGAACATCAACAGGACAAGAACAAAGAACTCAAATTGGGCAAAGGAAAAACACTTACAGCAACTGAAAAAAAAAAATTGAAGAAACCACTTAAACAAATTCAAGCAAATGACAAGAAAGCTGAAGAAAAAGCTGAAAAAAGAGCTCCAGAAAGTTCTGAAGAAATGGGAGAACCCGAAGAAAAGAAAAAGACTGCCTTTAGTTATGAAAAGAAAAACATAAGAAAGGAAGAAAAGAAACACATCCATATGTGAGAAATACTGGAAATTAAATAAACTCAAAGGAAAGAACGGGATATACAAAAGGCAAAATGCAGGTGTTGCAGAGAAAACTGAAGAGAATGGTAAAGAAGTCTGTGAAAGGCAAGGAGACACAAACCAGGAAGTAGAGAATTCTTTGAAGAGATGAGAGATCAACAAAGAGAAGAGTCAGTGAACAAGTGGACCCTACTCCAGATGATGCAGAATACTGCAATGAGGCATACTTAAGACCATTGTGAATGAGGTAGCTGACAAGATGCTGACCCCAAACCGAAAACAAAGCAAGCTGGATGTTTCTTCAATTGTAAAGCAATTGATAACAAACTTGACTTAATTCCTTTAAAAATGAAGAACCACCTCAGGTTAGATTCTGCATTCTTAGAGTTCTATGGTAGGTAATAAAAAGCAGAAAATCATAACTAAAGAATGGAAAGAGCAAACATGTCTTAGTTATGGAATCAGATGTGGTGATAGAATACACTGGAAGAGTAACAAAATGTGAAAAATATGTAAGTTTGCAGATAAGATTGAATCACAAAAAGCAAATAAACAAATCAAAGTGCTGAAGAAAAGGTAGGAAACAGATTAAAAACAATGAAATCAAAAGTCTTCTGGTTAAACTTGAAAAAGAACAGCTAGAAATAAAGGTAGAAAAGGAACTTCAAGAAGAAGATCAGCTCAGCTCTCAGAAAGATCAACTAAAGCCCCAAAAGAGATGGAAGAAAACTCTTAAAGTTAGAAGTGAAGTGAACAGATTTTTCAGAAGGTTTCATTCAGCTTAAAGAAGAGCAAGCTGCTCAAAGTAAAATACAAGCACAGGGACAATGGATTTTCCTCACACAGTTAAAAAAGATGATTACCTGATCCCAGTAGAATCTTCAAAGAAGGAAGAACTTTCTTCAGCAGAGAAGTTAAAAATGCAAAAGCTGACAGTAGAAATCTACACAACAATTACGAGCGTGAAAGAAGCGAAAAAGAGTCATCTGAATGTGCAAAAATAGATGAATTAATGAAAATGAAAGAGAACCAGAATCATGCAAAAATCTACAAAGAAGTTTTCAAATCTATTGAAAATGAATCTGATGATATAGAAGGGCAAGAACAGAAAAACGTTCAAGTTTTACAAAGAATCGATGAGTCCTCAGATACATCTAATGAACCCAGATGGTCCTAAGGAGAAGAGAATGCCCAATTTAATCAATGCTTCATTGGGAGGAGAGCATGGATCTGAAACCAAATGGACAACAAAGAAGTGAAGAAACTCCAACCAATTCCTACTGAAGAGGAAAATAAAAGAAAAAGAAAAGTAAAAATTTCTGAAACATTGGGTGAAAAGAAATGCCCACAATTAACTTCCTTAATGAAAATGATGAAACTAACTATGAGCTTCTGAAGTCTAGAAGTACTATGGAAGAGTGTGGAGACATTTTTACAAATTGCACAAATTAATTCTGGTTCAAGCAATCCAAAAAGATTGTACAAATTTCAGGTGAAAAAAACAGAGAAGTCCAAGAATATGAAGAAGTAGCTTTAACAAAAATAATCAAGAAAAGGACCAAAGAAATTGAAATCCATAAAACATTGGAAAAAATAGCCCCTATAAAAGACTATCTTCGACAAAGAGATACAGAAGCCCCAGAATCTCAAAGGAGACCACCCAAAGATCTCTTCAGTGATTCTCAGTGCTCTCAGAATAAGTTTCTTCCTGGTTGGGATACAGTCATCCTTTAATAGAACACTTGACTCTGTATTTCAATTTACTAAAAATGACGAAAAGAGAATTCTAAGATCACCGCTGGTGAGCAGAGATACCAGGAAGCTGTAAATCAAACCATCAAAGAATCAGGAATTCCTTTAGAGGAATTGATTCTTCTACATTTCAAGAAGACTTAAAAACACCAAAAAGACAAAAGTCAACTCCAAGACACAAACAAGGAAAACTTATTCAAACTTGTATGGAAAGGTAGTTCTACTGGCATTAATTTGTGCATATATCAGATCCCAGATATTATATGTAGTGATTTGTCCTTCAAATTTTTGCAGTTTTAGCATTGTATCCAGATGGAAAACAACAAAGATCCATGTGTGATAAAGGAAATTTAGAAAATGTTGTAGCACTTTTGGTCTTGGATTATTTCTCATTCTTAAAAAGCTTCAAGAAAATTCAGTTTTCTTCCTTAATAATGATAGTCATTTATTTCCAGCTGTGTTAGGAGGGAAAAATCGTGAAAGAAAAACTCAGGTCCAAGAAAAATTTCAAACCCAAATCATATTATACTTACAGTATTCTTGAACTGCACATCATCACCCAGTATGCAGACCGCAGTAGCTGCAGAGGATTTGTATGAAATGGTTCATTCTTCAAAAGGAATCAGGAAGAGGACTGTCACCTCTGACATCCAATCACTTTAGAAGAACCCCTTATGCTCAAATTGTTAGCAATTCTGGATTTAAAAAATTTGGTCCTTTTCTTAAAGAAGAAGCCAGTCTCTTCATGTTAGAAAAACTACAGAAAATAATAGAACTTACAGATGGGTCTGCAGTTGGAGAAAACACTCAAGAACAAACTGAAGGAAACATCAAGAGAGAAAACTACACAAGTCAAAAGCATTTTCCATTACCTCAAGTTATTTCAAATTCTTCAAACAAATTGTTGAAGAAACAAAAGATAAAATCTGGCACTTTAGGGCTGCAGAAAATACATTTGAAGCCGATATAGAAGCAGAATTAAAACCTGAACAAGAAGAACAAAGGAAACCTGAAAAAAAAATGAAATCTTAACAAACGAAAATGAGAAAATTCTTAAAGAAAATGAAACCACAAAAAATAAAAAAGCCGCCAGAGAGCATTTATCTAGAAAATCAGCCATTGGTATCGAAGATATTCAACAACTGGGACGAGAATGAACAAATTGAGGACATGAAAGCAGAAGTGGATGCCCAAGAAGTAAAAGAACCTGTTGTCAATAGTGAATTCATAAAAATTGGAGATTTTACGTGCAAAATTGAGAATATAAAGGATTTGTAAGTAAACGAGTTGGTCGAGGAGATAATTTACTTAAAGAACATTTTGAAGAAATTGAAAAAAAATTAAAAACTGACAAAAAACTTGTTGAATTGAGTACTGGATTTGCTACCTCTGCCCCAGAATATTCACGTATCAAAGAAAATGGATTAATGGGATATGAAGAACCATCAGTAGTAAAGTGATTTCATCTCTCAGTGATCGTTATTGCAGAGATAGTGAGCTTATTGAAAACACTCCTGTGGAAGTAATGCATACACAGCCTGAAACCACAAAAATTGATATGGAAGCAGTCATAGTAATTGGAAATGAAGAAATTGAAAATCTGAATAATATAGAAGCAAATACTCCT"

@pytest.mark.integration
def test_precision_forge():
    """
    Tests the isolated Precision Forge endpoint on the CommandCenter.
    """
    CommandCenter = modal.Cls.lookup("command-center-v8-override-fix", "CommandCenter")
    cc = CommandCenter()
    
    print("\n--- ðŸ”¬ Initiating isolated Precision Forge test... ---")
    
    candidates = cc.test_precision_forge.remote(BRCA1_BAIT_SEQUENCE)
    
    assert isinstance(candidates, list), f"Expected a list of candidates, but got {type(candidates)}"
    assert len(candidates) > 0, "Expected at least one candidate to be generated."
    
    print(f"--- âœ… SUCCESS: Received {len(candidates)} candidates from the Forge. ---")
    for i, c in enumerate(candidates):
        print(f"  Candidate {i+1} (first 60 chars): {c[:60]}...")
        assert isinstance(c, str)
        assert len(c) == 30 # ADAPT: Assert the Oracle's actual output length.

if __name__ == "__main__":
    test_precision_forge()

