# Plan: Integrate Mock Therapeutic System Designer into Streamlit

This document outlines the plan to integrate the `handle_design_therapy_interaction` function from `[ai_research_assistant.py](mdc:ai_research_assistant.py)` into the main Streamlit application. The goal is to provide users with an interactive way to trigger a mock multi-gene CRISPR therapy system design workflow and view its simulated results.

## 1. Core Objective

Integrate the mock therapeutic system design capability, primarily driven by the `handle_design_therapy_interaction` function in `[ai_research_assistant.py](mdc:ai_research_assistant.py)`, into the user-facing Streamlit application (either within `[streamlit_app.py](mdc:streamlit_app.py)` or as a new page in the `pages/` directory).

## 2. Key Modifications to `[ai_research_assistant.py](mdc:ai_research_assistant.py)`

The `handle_design_therapy_interaction` function needs the following enhancements for Streamlit integration:

*   **Dynamic Target Mutation:**
    *   Modify the function signature to accept `target_mutation_details: dict` as a parameter. This will replace the currently hardcoded `mock_target_mutation`.
*   **UI-Friendly Progress Reporting:**
    *   Modify the function signature to accept a `display_callback` function (e.g., `streamlit_display_callback(message: str)`) as a parameter.
    *   Replace all internal `print()` statements used for progress logging with calls to this `display_callback` function. This allows progress messages to be routed to the Streamlit UI instead of the console.
*   **Return Structured Results:**
    *   Modify the function to return the `mock_recommendations` list (a list of dictionaries) at the end of its execution. This structured data will be used for detailed display in the Streamlit UI.

## 3. Streamlit UI Implementation (New Page or Section)

A new UI component needs to be developed in Streamlit:

*   **Location:**
    *   Consider creating a new Python file in the `pages/` directory (e.g., `pages/Mock_Therapy_Design.py`) for a dedicated page.
    *   Alternatively, integrate as a new distinct section within `[streamlit_app.py](mdc:streamlit_app.py)` if a separate page is not desired.
*   **UI Elements & Workflow:**
    1.  **Title:** A clear title for the feature (e.g., "Mock Multi-Gene Therapeutic System Design").
    2.  **Target Mutation Input:**
        *   Mechanism to specify or confirm the `target_mutation_details`. This could leverage an existing `st.session_state.active_mutation` or include input fields (e.g., `st.text_input` for gene, protein change).
    3.  **Trigger Button:** A button (e.g., `st.button("Design Mock Therapy System")`) to initiate the workflow.
    4.  **Loading Indicator:** Use `st.spinner` during the execution of `handle_design_therapy_interaction` to indicate processing.
    5.  **Progress Display Area:**
        *   An `st.expander` or a dedicated `st.container` to display real-time progress messages received via the `display_callback`.
    6.  **Function Call:**
        *   On button click, call the modified `handle_design_therapy_interaction` function from `[ai_research_assistant.py](mdc:ai_research_assistant.py)`.
        *   Pass `st.session_state.conversation_history` (or the relevant chat history variable).
        *   Pass the collected `target_mutation_details`.
        *   Pass a Streamlit-specific callback function (e.g., a nested function that uses `st.text` or `st.info` to display messages in the progress area).
    7.  **Results Display:**
        *   Upon completion, iterate through the `mock_recommendations` list returned by the function.
        *   Display each recommendation in a structured and readable format. Consider using `st.expander` for each, with `st.markdown` for rationale/evidence and `st.json` or formatted text for component details and scores.
    8.  **AI Chat Integration:**
        *   Continue to display the overall conversation history (`st.session_state.conversation_history`), which will include the LLM's presentation of the mock results.

## 4. Dependencies and Environment Considerations

*   **Accessibility of `ai_research_assistant.py`:** Ensure the Streamlit environment can import `handle_design_therapy_interaction` and its dependencies (e.g., `[tools/mock_evo2_api.py](mdc:tools/mock_evo2_api.py)`, `tools.llm_api`). Adjust Python's `sys.path` if necessary or ensure appropriate project structure.
*   **API Keys:** Confirm that any required API keys (e.g., for the Gemini LLM provider used in `[ai_research_assistant.py](mdc:ai_research_assistant.py)`) are correctly configured and accessible in the Streamlit deployment environment.

## 5. User Experience and Clarity

*   **Mock Data Labeling:** Consistently and clearly label all outputs, scores, and rationales generated by this workflow as "SIMULATED" or "MOCK" within the Streamlit UI. This is crucial to manage user expectations.
*   **User Guidance:** Provide brief explanations or tooltips about the purpose of this mock design feature and its limitations.

This plan provides a roadmap for integrating the advanced mock therapy design capabilities into the interactive Streamlit application.
